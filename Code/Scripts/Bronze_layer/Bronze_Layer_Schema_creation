
-- Create a new Database for our Datawarehouse
create database insureme_dw;

-- CREATE SCHEMA For each layers
CREATE SCHEMA IF NOT EXISTS bronze;
CREATE SCHEMA IF NOT EXISTS silver;
CREATE SCHEMA IF NOT EXISTS gold;




-- Create bronze table for customers table

DROP TABLE IF EXISTS bronze.oltp_customers;

CREATE TABLE bronze.oltp_customers (
    customer_id        VARCHAR(50),
    first_name         VARCHAR(100),
    second_name        VARCHAR(100),
    postcode           VARCHAR(20),
    d_o_b              DATE,
    created_at         TIMESTAMP,
    updated_at         TIMESTAMP,
    ingestion_ts       TIMESTAMP DEFAULT NOW() NOT NULL,
    source_system      VARCHAR(50) DEFAULT 'OLTP'
);


-- Create bronze table for customer Financial table


DROP TABLE IF EXISTS bronze.oltp_customer_financial_profile;

CREATE TABLE bronze.oltp_customer_financial_profile (
    profile_id     VARCHAR(50),
    customer_id    VARCHAR(50),
    credit_score   NUMERIC(3),
    source         VARCHAR(100),
    retrieved_at   DATE,
    created_at     TIMESTAMP,
    updated_at     TIMESTAMP,
    ingestion_ts   TIMESTAMP DEFAULT NOW() NOT NULL,
    source_system  VARCHAR(50) DEFAULT 'OLTP'
);



-- Create bronze table for Policy table

DROP TABLE IF EXISTS bronze.oltp_policy;

CREATE TABLE bronze.oltp_policy (
    policy_id        VARCHAR(50),
    customer_id      VARCHAR(50),
    annual_premium_amount NUMERIC(15,2),
    policy_type      VARCHAR(50),
    start_date       DATE,
    end_date         DATE,
    status           VARCHAR(20),
    created_at       TIMESTAMP,
    updated_at       TIMESTAMP,
    ingestion_ts     TIMESTAMP DEFAULT NOW() NOT NULL,
    source_system    VARCHAR(50) DEFAULT 'OLTP'

);


-- Create bronze table for Claims table

DROP TABLE IF EXISTS bronze.oltp_claims;

CREATE TABLE bronze.oltp_claims (
    claim_id             VARCHAR(50),
    policy_id            VARCHAR(50),
    incident_date_time   TIMESTAMP,
    report_date          DATE,
    claim_amount         NUMERIC(15,2),
    incident_type        VARCHAR(100),
    incident_lat         NUMERIC(10,6),
    incident_long        NUMERIC(10,6),
    incident_location    VARCHAR(200),
    status               VARCHAR(20),
    created_at           TIMESTAMP,
    updated_at           TIMESTAMP,
    ingestion_ts         TIMESTAMP DEFAULT NOW() NOT NULL,
    source_system        VARCHAR(50) DEFAULT 'OLTP'
    
);
